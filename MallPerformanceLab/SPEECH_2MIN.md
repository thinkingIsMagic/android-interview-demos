# Mall Performance Lab - 2分钟讲稿

## 开场 (10秒)

> 各位面试官好，今天我想通过一个我自研的Demo项目，聊聊商城页性能优化的方法论。

---

## 项目背景 (20秒)

> 这是一个叫"Mall Performance Lab"的Android Demo，核心是**Baseline vs Optimized双版本对照**。
>
> 我把电商首页拆成了两部分：
> - 营销区：Banner、优惠券、商品网格（配置化渲染）
> - Feed流：无限列表、分页加载
>
> 所有优化策略都打了点，可观测、可测量。

---

## 核心优化点 (60秒)

> 我做了四类优化：

### 1. 缓存策略（看家本领）

> 首先是缓存，这是电商首页的看家本领。
> - 内存缓存用LruCache，磁盘用SharedPreferences
> - 查询顺序：内存未命中 → 查磁盘 → 回填内存
> - 效果：缓存命中<1ms，网络请求要300-1500ms
>
> 关键技术是TTL：首页数据5分钟过期，Feed2分钟，避免数据stale。

### 2. 预请求策略（并行化）

> 第二是预请求，避免串行等待。
> - 用户进入页面前500ms就发起请求
> - 做了请求去重：相同key只发一次
> - 首屏数据优先级最高
>
> 这样用户看到页面时，数据已经在缓存里了。

### 3. 预加载策略（异步化）

> 第三是预加载，解决图片和View的阻塞。
> - 图片异步解码，不卡主线程
> - Feed滚动到底部前3条时，预取下一页
>
> 这里用了Coroutine+Dispatchers.IO，异步并行。

### 4. 预创建策略（ViewPool）

> 第四是View预创建，消除inflate耗时。
> - Application启动时就预创建了24个View
> - 放入池子，页面用的时候acquire，用完release
>
> inflate一次要5-20ms，移到后台做，首帧就快很多。

---

## 效果展示 (20秒)

> 我们有四个关键打点：

| 指标 | Baseline | Optimized | 提升 |
|------|----------|-----------|------|
| 首屏数据到达 | 800ms | 50ms | 94% |
| 首屏渲染完成 | 120ms | 60ms | 50% |
| 首屏可交互 | 200ms | 120ms | 40% |

> 这些数据在Logcat里能看到，我们还做了一个"报告"按钮，一键输出对比。

---

## 技术难点 (10秒)

> 过程中遇到的坑：
> - 缓存和预取的数据一致性：用TTL+版本号解决
> - View复用时的状态污染：每次release都重置
> - 并发安全：用Coroutine+Mutex控制

---

## 结尾 (10秒)

> 这套优化思路，可以复用到任何列表型页面。
> 核心是：缓存减少网络、并行减少等待、预创建减少主线程阻塞。
>
> 谢谢。

---

## 备用：被追问时的回答

**Q: 为什么用SharedPreferences不用数据库？**
> Demo场景下SP够用了。生产环境会换成Room，查询能力更强。

**Q: 预请求如果用户没进页面怎么办？**
> 会浪费一点流量，所以我加了5分钟TTL，没进页面数据就过期了。

**Q: ViewPool会内存泄漏吗？**
> 不会，我们有clear()方法在onDestroy调用，而且用的是Application Context。
